.Система для создания синтетических флорпланов (floorplans) и их визуализации в виде изображений.
Цель — получение разнообразного датасета для задач computer vision (segmentation / detection / parsing).

Реализация должна состоять из двух логических частей:

floorplan_generator.py — генерирует структурированное описание флорплана в JSON

generate_synthetic.py — рендерит изображение флорплана на основе этого JSON

Использовать Python 3.11+, numpy, Pillow, при необходимости shapely для геометрии.
Используй uv.

Код должен поддерживать воспроизводимость через random seed.

1. Генерация структуры флорплана (floorplan_generator.py)
1.1 Управляемые параметры генерации

Генератор должен принимать параметры:

num_rooms — количество основных комнат (N)

min_room_size, max_room_size — диапазоны размеров помещений

indent_prob — вероятность, что помещение имеет выемку в стене

indent_depth_range, indent_width_range — параметры выемки

global_wall_thickness — базовая толщина стен (общая для флорплана)

wall_thickness_variation_prob — вероятность, что конкретная стена толще

wall_thickness_multiplier_range — диапазон утолщения стены

door_prob — вероятность появления двери между соседними помещениями

window_prob — вероятность появления окна на внешней стене

вероятности типов добавляемых помещений:

обычная комната

коридор

санузел

техническое помещение

Санузлы и тех.помещения обычно меньше по размеру.

1.2 Алгоритм построения флорплана

Флорплан не должен быть прямоугольным зданием.
Он формируется как “растущая структура” из помещений.

Алгоритм:

Сгенерировать первое помещение.

Далее итеративно:

выбрать существующее помещение

выбрать случайную стену

пристроить к этой стене новое помещение

Проверить, что помещения не пересекаются.

Повторять, пока не будет создано нужное количество помещений.

Таким образом внешний контур получается ломаным и естественным.

1.3 Геометрия помещений

Каждое помещение задаётся полигоном.

Обычно — прямоугольник, но с вероятностью indent_prob:

помещение имеет внутреннюю нишу (indentation):

прямоугольная выемка внутрь стены

выбирается случайная стена

контролировать, чтобы полигон оставался корректным

Коридоры должны чаще быть вытянутыми (большее отношение сторон).

1.4 Стены

Каждая стена хранится как отдельный сегмент с параметрами:

координаты начала и конца

толщина стены

признак внешняя / внутренняя

Толщина стены:

по умолчанию = global_wall_thickness

иногда увеличивается случайно.

1.5 Двери

Двери создаются на общей стене двух помещений.

Параметры двери:

положение вдоль стены (доля длины)

ширина

направление открытия (left/right)

тип отображения (style hint)

1.6 Окна

Окна размещаются только на внешних стенах.

Параметры:

позиция вдоль стены

ширина

1.7 Типы помещений

Каждое помещение имеет тип:

room

corridor

bathroom

utility

1.8 Формат JSON (который должен генерироваться)
{
  "meta": {
    "seed": 123,
    "global_wall_thickness": 8
  },
  "spaces": [
    {
      "id": "space_001",
      "type": "room",
      "polygon": [[x,y], [x,y], ...],
      "walls": [
        {
          "p1": [x,y],
          "p2": [x,y],
          "thickness": 8,
          "is_external": true,
          "openings": [
            {"type":"door","width":90,"offset":0.3,"swing":"left"},
            {"type":"window","width":120,"offset":0.6}
          ]
        }
      ]
    }
  ]
}
2. Рендер изображения (generate_synthetic.py)

Этот модуль должен принимать JSON и генерировать изображение флорплана.

2.1 Отрисовка стен

Стены рисуются линиями соответствующей толщины.

Цвет стен выбирается случайно из заданной палитры.

Стиль изображения должен случайно варьироваться.

2.2 Отрисовка дверей

Двери должны выглядеть как на архитектурных планах:

дуга открытия (полуарка)

иногда показывать пустой проём, иногда нет

несколько вариантов визуального стиля

2.3 Отрисовка окон

Окна отображаются как 3-4 параллельные тонкие линии.

2.4 Заливка помещений

Некоторые помещения могут иметь случайную заливку.

2.5 Добавление мебели

Внутри помещений случайно размещаются PNG-иконки мебели:

берутся из директории /furniture_icons

масштабируются и поворачиваются

размещаются внутри полигона помещения

2.6 Размерные обозначения

Для реалистичности нужно добавлять элементы, имитирующие реальные чертежи:

размерные линии

стрелки

числа (габариты)

случайные подписи

2.7 Вариативность стиля

Каждое изображение должно отличаться:

толщинами линий

цветами

наличием заливки

стилем дверей

количеством мебели

наличием аннотаций

3. Геометрическая корректность (обязательно)

Нужно гарантировать:

помещения не пересекаются

двери только между соседями

окна только на внешних стенах

структура похожа на реальную квартиру, а не на сетку

4. Допустимые библиотеки

Можно использовать:

numpy

Pillow

shapely (желательно для геометрии)